This is my modification DEV-4713 pull-request for A.
And a bugfix for BUG-4812 (which is also the ref in JIRA).
This is additional code for DEV-4813.
